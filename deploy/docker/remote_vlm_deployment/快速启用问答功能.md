# 快速启用 VSS 问答功能

## 🎯 问题分析

VSS 的 CA-RAG 模块（问答功能）要求使用 Embedding API。当前配置使用智谱AI，但系统内部硬编码了 NVIDIA API 的调用方式，导致路径错误：

```
错误: /v4/v1/embeddings  ← 路径重复
正确: /v4/embeddings
```

## ✅ 最简单解决方案：使用 NVIDIA 免费 API

### 步骤1：获取免费 API Key（3分钟）

1. **访问**: https://build.nvidia.com/
2. **注册/登录**: 可用 Google/GitHub/Email
3. **点击**: 右上角 "Get API Key" 或 "Login"
4. **获取**: 在个人中心找到 API Key
5. **复制**: 格式为 `nvapi-xxxxxxxx`

**免费额度**:
- ✅ 无需信用卡
- ✅ 1000+ 次调用/天
- ✅ 多个模型可选
- ✅ 永久免费测试额度

### 步骤2：修改配置

编辑 `deploy.sh` 第40行：

```bash
# 将这行：
export EMBEDDING_API_KEY="nvapi-在这里填写你的免费KEY"

# 改为：
export EMBEDDING_API_KEY="nvapi-你实际的KEY"
```

### 步骤3：重新部署

```bash
cd /Users/cauchy/gitrepo/video-search-and-summarization/deploy/docker/remote_vlm_deployment

# 停止服务
docker-compose down

# 重新部署
./deploy.sh

# 查看日志
docker-compose logs -f via-server
```

### 步骤4：验证成功

日志中应该看到：

```
✓ Initialized VIA Stream Handler
INFO Starting frontend server...
```

**不再有** embedding 相关的404错误！

## 🎉 完成后可用功能

| 功能 | 状态 |
|------|------|
| ✅ 视频摘要 | 可用 |
| ✅ 视频问答 | 可用 |
| ✅ 语义搜索 | 可用 |
| ✅ 时间定位 | 可用 |

## 📊 为什么这是最简单的方案？

| 方案 | 优点 | 缺点 | 难度 |
|------|------|------|------|
| **NVIDIA API** | ✅ 无需补丁<br>✅ 5分钟搞定<br>✅ 原生支持 | ⚠️ 需注册 | ⭐ 简单 |
| 补丁方案 | ✅ 可用任何API | ❌ 补丁复杂<br>❌ 易出错 | ⭐⭐⭐⭐⭐ 复杂 |
| 本地部署 | ✅ 无依赖 | ❌ 需额外GPU<br>❌ 配置繁琐 | ⭐⭐⭐ 中等 |

## 🔧 故障排查

### 问题1：API Key 无效

**症状**: `401 Unauthorized`

**解决**:
- 确认 Key 以 `nvapi-` 开头
- 检查是否复制完整
- 重新获取新的 Key

### 问题2：网络连接问题

**症状**: `Connection timeout`

**解决**:
```bash
# 测试连接
curl -H "Authorization: Bearer nvapi-你的KEY" \
  https://integrate.api.nvidia.com/v1/models
```

如果国内网络访问不了，考虑：
- 使用代理
- 或使用本地部署方案

### 问题3：仍然有 embedding 错误

**检查配置**:
```bash
# 查看环境变量
docker-compose exec via-server env | grep EMBEDDING

# 应该显示：
# EMBEDDING_BASE_URL=https://integrate.api.nvidia.com/v1
# EMBEDDING_MODEL_NAME=nvidia/llama-3.2-nv-embedqa-1b-v2
# EMBEDDING_API_KEY=nvapi-xxxxx
```

## 💡 后续：如果需要使用智谱AI

如果未来仍想使用智谱AI的 embedding：

### 方案A：使用智谱AI官方 Langchain 集成

等待 VSS 支持更多 embedding 类型，或贡献代码支持 `langchain-zhipuai`。

### 方案B：本地部署 OpenAI-compatible Embedding

使用 vLLM 或 Xinference 部署智谱的开源 embedding 模型。

## 📚 相关资源

- NVIDIA API 文档: https://docs.nvidia.com/ai-foundry/
- NVIDIA Build 平台: https://build.nvidia.com/
- Embedding 模型列表: https://build.nvidia.com/explore/retrieval

---

**总结**: 注册 NVIDIA，填写 API Key，重新部署，3分钟搞定！ 🚀

