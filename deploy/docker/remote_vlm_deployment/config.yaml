######################################################################################################
# SPDX-FileCopyrightText: Copyright (c) 2024-2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
######################################################################################################
---
# Environment configuration

tools:
  graph_db:
    type: neo4j
    params:
      host: !ENV ${GRAPH_DB_HOST}
      port: !ENV ${GRAPH_DB_BOLT_PORT}
      username: !ENV ${GRAPH_DB_USERNAME}
      password: !ENV ${GRAPH_DB_PASSWORD}
    tools:
      embedding: nvidia_embedding

  vector_db:
    type: milvus
    params:
      host: milvus-standalone
      port: "19530"
    tools:
      embedding: nvidia_embedding

  chat_llm:
    type: llm
    params:
      model: !ENV ${LLM_MODEL_NAME}
      base_url: !ENV ${LLM_BASE_URL}
      max_tokens: 2048
      temperature: 0.2
      top_p: 0.7
      api_key: !ENV ${LLM_API_KEY}

  summarization_llm:
    type: llm
    params:
      model: !ENV ${LLM_MODEL_NAME}
      base_url: !ENV ${LLM_BASE_URL}
      max_tokens: 2048
      temperature: 0.2
      top_p: 0.7
      api_key: !ENV ${LLM_API_KEY}

  notification_llm:
    type: llm
    params:
      model: !ENV ${LLM_MODEL_NAME}
      base_url: !ENV ${LLM_BASE_URL}
      max_tokens: 2048
      temperature: 0.2
      top_p: 0.7
      api_key: !ENV ${LLM_API_KEY}

  nvidia_embedding:
    type: embedding
    params:
      model: !ENV ${EMBEDDING_MODEL_NAME}
      base_url: !ENV ${EMBEDDING_BASE_URL}
      api_key: !ENV ${EMBEDDING_API_KEY}

  # nvidia_reranker:  # 可选组件，已禁用
  #   type: reranker
  #   params:
  #     model: !ENV ${RERANKER_MODEL_NAME}
  #     base_url: !ENV ${RERANKER_BASE_URL}
  #     api_key: !ENV ${RERANKER_API_KEY}

  notification_tool:
    type: alert_sse_notifier
    params:
      endpoint: "http://127.0.0.1:60000/via-alert-callback"

functions:
  summarization:
    type: batch_summarization
    params:
      batch_size: 6
      batch_max_concurrency: 20
      prompts:
        caption: "请详细描述图片或视频中的内容，包括场景、人物、物体、动作、环境等关键信息。"
        caption_summarization: "请总结以下内容的关键信息和要点。"
        summary_aggregation: "请将以下描述整合为一个连贯的总结，突出重点内容。"
    tools:
      llm: summarization_llm
      db: graph_db

  ingestion_function:
    type: graph_ingestion
    params:
      batch_size: 1
      image: false
      cot: false
      top_k: 5
      #disable_entity_extraction: True  # uncomment this line for DGX Spark
    tools:
      llm: chat_llm
      db: graph_db

  retriever_function:
    type: graph_retrieval
    params:
      batch_size: 1
      image: false
      cot: false
      top_k: 5
    tools:
      llm: chat_llm
      db: graph_db

  notification:
    type: notification
    params:
      events: []
    tools:
      llm: notification_llm
      notification_tool: notification_tool

context_manager:
  functions:
    - summarization
    - ingestion_function
    - retriever_function
    - notification
